<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>
    
	       Schmusic, résultat d&#39;une petite heure d&#39;ennui.
           - Schoewilliam 
    
    </title>
    
    
    <meta name="description" content="Open web enthusiast, non-writer writer, Iceland dreamer.">
    
    
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css">
    <link rel="alternate" type="application/rss+xml" title="Schoewilliam.fr RSS (FR posts)" href="/flux.xml">
    <link rel="alternate" type="application/rss+xml" title="Schoewilliam.fr RSS (EN posts)" href="/feed.xml">

    <meta name="author" content="William Dorffer aka. Schoewilliam">
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    
  </head>
  
  <body class="post">
  
    <header>
        <div class="left">
            <a onclick="document.querySelector('body > aside').classList.toggle('nav-shown'); document.querySelector('.menu').classList.toggle('shown');" class="menu"><span class="mega-octicon octicon-three-bars"></span></a>
            
            <a class="small-site-title" href="/">Schoewilliam</a>
            
        </div>
        <div class="right">
            
            
            
                <a class="active" href="/2013/08/02/music-schoewilliam-fr-r%C3%A9sultat-dune-heure-d-ennui.html">fr</a>
            
            <a title="Allumer/Éteindre la lumière" class="lights"><span class="mega-octicon octicon-light-bulb"></span></a>
        </div>
    </header>

    <aside>
        <div class="book-title">
            
                <h1>Schmusic, résultat d'une petite heure d'ennui.</h1>
            
        </div>

        <nav id="nav">
    
        <a href="/a-propos">À Propos</a>
    
        <a href="/projets">Projets</a>
    
        <a href="/archive">Blog</a>
    
        <a href="/a-propos#contact">Contact</a>
    
</nav>


        <nav id="prevnext">
           
                
                    <a class="prev" title="Premières joies de l'autohébergement" href="/2013/08/01/premi%C3%A8res-joies-de-l-autoh%C3%A9bergement.html">
                        Article précédent
                    </a>
                

                
                    <a class="next" title="Ouvrez votre gueule." href="/2013/08/10/ouvrez-votre-gueule.html">
                        Article suivant
                    </a>
                
           
        </nav>
    </aside>


    <!-- Page content -->
    <section>
    <div class="post">
        

        <time datetime='2 August 2013' class="top">
  
  
    2
  



 
 août
    

2013
</time>
        <p><img src="/images/mpd/music.schoewilliam.png" alt="music.schoewilliam.fr" class="align right" style="border-radius:3px;" /></p>

<p>Je m’ennuyais, tout à fait. Alors je me suis dit que je devrais peut-être faire une jolie petite page statique pour mon stream <em>MPD</em> — dont je parle dans mon <a href="/2013/08/01/premières-joies-de-l-autohébergement.html">billet d’hier</a>.</p>

<p><a href="http://music.schoewilliam.fr" target="_blank">Le résultat</a> correspond à ce que j’avais imaginé, et dispose même d’une fonctionnalité supplémentaire à mon idée de base : l’affichage de l’artiste et du titre de la piste en cours de diffusion.</p>

<hr />

<p>L’ensemble est plutôt simple. Il s’agit dans un premier temps, d’installer un serveur <strong>icecast</strong> en parallèle à l’instance <strong>MPD</strong>, et de configurer ce dernier pour émettre dans un stream icecast. <code>.mpdconf</code> :</p>

<pre><code>audio_output {
    type            "shout"
    encoding        "ogg"
    name            "Now listening to..."
    host            "localhost"
    port            "8000"
    mount           "/mpd.ogg"
    password        "thispasswordcannotbehackedohyeah"
    quality         "3.0"
    format          "44100:16:2"
    description     "My playlist of the day. Normal quality (3) OGG/Vorbis stream."
}
</code></pre>

<p>Ainsi, après avoir lancé Icecast <strong>puis</strong> mpd, notre stream sera accessible à l’adresse <a href="http://localhost:8000/mpd.ogg">http://localhost:8000/mpd.ogg</a>.</p>

<hr />

<h2 id="les-contrles">Les contrôles.</h2>

<p>En ce qui concerne maintenant notre jolie page web, on utilisera la balise <code>&lt;audio&gt;</code> :</p>

<pre><code>&lt;audio id="stream" preload="none"&gt;
	&lt;source type="audio/ogg" src="http://music.schoewilliam.fr:8000/mpd.ogg"&gt;&lt;/source&gt;
	&lt;p&gt;It looks like your browser cannot play this stream. You can instead play &lt;a href="http://music.schoewilliam.fr:8000/mpd.ogg"&gt;http://music.schoewilliam.fr:8000/mpd.ogg&lt;/a&gt; in a media player (such as VLC or MPlayer).&lt;/p&gt;
&lt;/audio&gt;
</code></pre>

<p>Quant aux contrôles de lecture, s’agissant d’un stream, j’ai choisi de me contenter des boutons de volume, ainsi que d’un bouton central Play/Pause :</p>

<pre><code>&lt;div id="controls"&gt;
	&lt;a href="#" onclick="document.getElementById('stream').volume-=0.2"&gt;Baisser le volume&lt;/a&gt;
	&lt;a href="#" id="playbut"&gt;Play&lt;/a&gt;
	&lt;a href="#" onclick="document.getElementById('stream').volume+=0.2"&gt;Augmenter le volume&lt;/a&gt;
&lt;/div&gt;
</code></pre>

<p>Nous n’avons maintenant plus qu’à rendre le bouton Play/Pause fonctionnel, comme suit :</p>

<pre><code>&lt;script type="text/javascript"&gt;
var player = document.getElementById('stream'),
    ctrl = document.getElementById('playbut');

ctrl.onclick = function () {

    // Update the Button
    var pause = ctrl.innerHTML === 'Pause';
    ctrl.innerHTML = pause ? 'Play' : 'Pause';

    // Update the Audio
    var method = pause ? 'pause' : 'play';
    player[method]();

    // Prevent Default Action
    return false;
};
&lt;/script&gt;
</code></pre>

<hr />

<h2 id="afficher-le-titre-en-cours">Afficher le titre en cours.</h2>

<p>Maintenant que nous avons un joli lecteur, on va l’agrémenter d’un petit plus fort pratique et agréable : l’affichage du titre (et de l’artiste) de la chanson en cours de diffusion sur le stream.<br />
J’ai pour cela récupéré <a href="https://github.com/Schoewilliam/music.schoewilliam/blob/master/nowplaying.php">un script php</a> trouvé sur les internœuds, que j’ai personnellement appelé <code>nowplaying.php</code>.<br />
En bref, son rôle sera de parser la page <a href="http://localhost:8000/status.xsl">http://localhost:8000/status.xsl</a> afin de récupérer les infos du stream.</p>

<p>Si l’on jette un œil aux dernières lignes du script, que j’ai ajoutées —</p>

<pre><code>$current = ($radio_info['now_playing']['artist'] . ' · ' . $radio_info['now_playing']['track']);
print $current;
</code></pre>

<p>— bien que le script permette d’afficher davantage, je ne choisis que d’afficher le nom de l’artiste (<code>$radio_info['now_playing']['artist']</code>), ainsi que le titre de la piste (<code>$radio_info['now_playing']['track']</code>). (à considérer donc si vous vous en servez.)</p>

<p>Nous voilà alors de retour sur notre jolie page web. On y appelle notre <code>nowplaying.php</code> de manière régulière avec du js (<em>jquery requis</em>). Et le tour est joué.</p>

<pre><code>&lt;script type="text/javascript"&gt;
	$(document).ready(function() {
	    setInterval(function(){
		   $("#current-track").load("nowplaying.php");
	    }, 10000);
	});
&lt;/script&gt;

&lt;div&gt;
  Now playing : &lt;span id="current-track"&gt;&lt;/span&gt;
&lt;/div&gt;
</code></pre>

<hr />

<p><a href="http://music.schoewilliam.fr"><em>And voilà</em></a>. Il n’y a plus qu’à s’amuser avec le CSS. Par ailleurs, ce concernant, j’ai choisi d’utiliser <a href="http://fontawesome.io/">Font Awesome</a> pour les jolies petites icônes (Lecture, Volume{-,+}, …), qui rendent je l’admets plutôt bien.</p>

<p>Les sources de tout ceci sont à retrouver sur mon dépôt git <a href="https://github.com/Schoewilliam/music.schoewilliam">https://github.com/Schoewilliam/music.schoewilliam</a>.</p>

<p>Kashyyyk.</p>


        <p style="text-align:right;">
        
        
            <span style="float:right; margin-left:.25em;" class="mega-octicon octicon-tag"></span>
            <a href="/archive#musique">Musique</a>.
        
        
        </p>
    </div>
</section>


    <script src="/js/nightmode.js" type="text/javascript"></script>
    <script src="/js/smooth-scroll.js" type="text/javascript"></script>

     <!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.schoewilliam.fr/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//piwik.schoewilliam.fr/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

  </body>
</html>
